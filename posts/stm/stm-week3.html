<!-- _layouts/default.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- _includes/head.html -->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <title>STM Week 3: HAL/LL Libraries - yoonzh.com</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="ìœ¤å¿—" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#0a0a0a" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0a0a0a" />
  <link rel="manifest" href="/site.webmanifest" />
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
  
  
</head>
</head>
<body class="">
  <!-- _includes/header.html -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K2M9QVQ44D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K2M9QVQ44D');
</script>

<header class="site-header">
  <div class="nav-container">
    <div class="logo-group">
      <a href="/" class="logo-image">
        <img src="/images/pepito-square.jpg" alt="Home">
      </a>
      <div class="logo-container">
        <a href="/" class="logo-link">
          <h1 class="logo">ìœ¤å¿—</h1>
        </a>
        <p class="logo-subtitle">[äº‘ ~ ì°Œ]</p>
      </div>
    </div>
    <nav class="nav-links">
      
        <a href="/projects/" class="hover-glow">Projects</a>
      
        <a href="/posts/" class="hover-glow">Posts</a>
      
        <a href="/about/" class="hover-glow">About</a>
      
    </nav>
  </div>
</header>
  
  <main class="page-content">
    <!-- _layouts/post.html -->
<article class="article-detail">
  <!-- _includes/article-content.html -->
<header class="article-header">
  <h1>
    STM Week 3: HAL/LL Libraries
    
  </h1>
  
  <div class="tech-tags">
    
      <span class="tech-tag">C/C++</span>
    
  </div>
  
  <div class="article-meta">
    
      <time datetime="2025-03-08T00:00:00+00:00">
        ðŸ“… 2025/03/08
      </time>
    
  </div>
</header>

<div class="article-content">
  <p><em>Adapted from <sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></em></p>

<h1 id="concepts">Concepts</h1>

<h2 id="1-hal-hardware-abstraction-layer">1. HAL (Hardware Abstraction Layer)</h2>
<p>A middleware library that abstracts hardware complexity, providing portable APIs for peripheral control (e.g., <code class="language-text highlighter-rouge">HAL_GPIO_WritePin()</code>)</p>

<p>Structure:</p>
<ul>
  <li><strong>Modular</strong>: Each peripheral (GPIO, UART, TIM) has dedicated <code class="language-text highlighter-rouge">.c/.h</code> files (e.g., <code class="language-text highlighter-rouge">stm32f4xx_hal_gpio.c</code>)</li>
  <li><strong>Callbacks</strong>: Event-driven design (e.g., <code class="language-text highlighter-rouge">HAL_GPIO_EXTI_Callback()</code> for interrupts)</li>
  <li><strong>Overhead</strong>: Includes error checks, state management, and generic initialization</li>
</ul>

<h2 id="2-ll-low-layer-libraries">2. LL (Low-Layer) Libraries</h2>
<p>Lightweight, register-level drivers for direct hardware access with minimal overhead</p>

<p>Structure:</p>
<ul>
  <li><strong>Direct Register Access</strong>: Functions map to hardware registers (e.g., <code class="language-text highlighter-rouge">LL_GPIO_SetOutputPin()</code> writes directly to <code class="language-text highlighter-rouge">GPIOx-&gt;BSRR</code>)</li>
  <li><strong>No State Management</strong>: Stateless functions for maximum speed</li>
  <li><strong>CMSIS-Compliant</strong>: Built on top of CMSIS-Core for ARM Cortex-M</li>
</ul>

<h2 id="3-hal-vs-ll-comparison">3. HAL vs. LL Comparison</h2>

<table>
  <thead>
    <tr>
      <th><strong>Feature</strong></th>
      <th><strong>HAL</strong></th>
      <th><strong>LL</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Abstraction</strong></td>
      <td>High (portable across STM32 families)</td>
      <td>Low (device-specific)</td>
    </tr>
    <tr>
      <td><strong>Code Size</strong></td>
      <td>Larger (boilerplate code)</td>
      <td>Smaller</td>
    </tr>
    <tr>
      <td><strong>Execution Speed</strong></td>
      <td>Slower (overhead from checks)</td>
      <td>Faster (direct register access)</td>
    </tr>
    <tr>
      <td><strong>Use Case</strong></td>
      <td>Rapid prototyping</td>
      <td>Time-critical applications</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="examples">Examples</h2>

<h3 id="1-hal-gpio-toggle">1. HAL GPIO Toggle</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HAL: Toggle LED on PA5</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">GPIO_PIN_5</span><span class="p">,</span> <span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">GPIO_PIN_5</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
<span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="2-ll-gpio-toggle">2. LL GPIO Toggle</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// LL: Toggle LED on PA5</span>
<span class="n">LL_GPIO_SetOutputPin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">LL_GPIO_PIN_5</span><span class="p">);</span>
<span class="n">LL_mDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="n">LL_GPIO_ResetOutputPin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">LL_GPIO_PIN_5</span><span class="p">);</span>
<span class="n">LL_mDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="3-button-interrupt-with-ll">3. Button Interrupt with LL</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// LL EXTI Configuration (in MX_GPIO_Init)</span>
<span class="n">LL_EXTI_InitTypeDef</span> <span class="n">EXTI_InitStruct</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">EXTI_InitStruct</span><span class="p">.</span><span class="n">Line_0_31</span> <span class="o">=</span> <span class="n">LL_EXTI_LINE_0</span><span class="p">;</span> <span class="c1">// PA0</span>
<span class="n">EXTI_InitStruct</span><span class="p">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">LL_EXTI_MODE_IT</span><span class="p">;</span>
<span class="n">EXTI_InitStruct</span><span class="p">.</span><span class="n">Trigger</span> <span class="o">=</span> <span class="n">LL_EXTI_TRIGGER_RISING</span><span class="p">;</span>
<span class="n">EXTI_InitStruct</span><span class="p">.</span><span class="n">LineCommand</span> <span class="o">=</span> <span class="n">ENABLE</span><span class="p">;</span>
<span class="n">LL_EXTI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">EXTI_InitStruct</span><span class="p">);</span>

<span class="c1">// Enable NVIC Interrupt</span>
<span class="n">NVIC_SetPriority</span><span class="p">(</span><span class="n">EXTI0_IRQn</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">NVIC_EnableIRQ</span><span class="p">(</span><span class="n">EXTI0_IRQn</span><span class="p">);</span>

<span class="c1">// Interrupt Handler (in stm32f4xx_it.c)</span>
<span class="kt">void</span> <span class="nf">EXTI0_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">LL_EXTI_IsActiveFlag_0_31</span><span class="p">(</span><span class="n">LL_EXTI_LINE_0</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">LL_EXTI_ClearFlag_0_31</span><span class="p">(</span><span class="n">LL_EXTI_LINE_0</span><span class="p">);</span>
    <span class="c1">// Toggle LED</span>
    <span class="n">LL_GPIO_TogglePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">LL_GPIO_PIN_5</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="questions">Questions</h2>

<ol>
  <li>Why is LL faster than HAL?</li>
  <li>How do you enable an EXTI interrupt in LL?</li>
  <li>What is the HAL function equivalent to <code class="language-text highlighter-rouge">LL_GPIO_SetOutputPin()</code>?</li>
  <li>How to measure HAL overhead?</li>
</ol>

<hr />

<h1 id="project-led-blinker-with-ll-drivers">Project: LED Blinker with LL Drivers</h1>
<p>Rewrite the LED Blinker from Week 1 to use LL instead of HAL.</p>
<ul>
  <li>Replace HAL with LL for GPIO and delay functions</li>
  <li>Implement a button interrupt using LL EXTI</li>
  <li>Compare HAL/LL execution cycles using STM32CubeMonitor</li>
</ul>

<h2 id="steps">Steps</h2>
<ol>
  <li>Create a New Project in STM32CubeIDE:
    <ul>
      <li>Select your STM32F4 board</li>
      <li>In Project Manager &gt; Advanced Settings, set <code class="language-text highlighter-rouge">GPIO</code> and <code class="language-text highlighter-rouge">EXTI</code> to <code class="language-text highlighter-rouge">LL</code></li>
      <li>Generate code</li>
    </ul>
  </li>
  <li>Implement LED Blinking with LL:
    <ul>
      <li>Replace <code class="language-text highlighter-rouge">HAL_GPIO_WritePin()</code> with <code class="language-text highlighter-rouge">LL_GPIO_Set/ResetOutputPin()</code></li>
      <li>Use <code class="language-text highlighter-rouge">LL_mDelay()</code> for delays</li>
    </ul>
  </li>
  <li>Configure Button Interrupt with LL:
    <ul>
      <li>Use <code class="language-text highlighter-rouge">LL_EXTI_Init()</code> to set up PA0 as an interrupt source</li>
      <li>Enable the NVIC interrupt</li>
    </ul>
  </li>
  <li>Measure Execution Cycles:
    <ul>
      <li>Use <code class="language-text highlighter-rouge">LL_GPIO_TogglePin()</code> in a loop without delays</li>
      <li>Connect STM32CubeMonitor to measure GPIO toggling frequency</li>
    </ul>
  </li>
  <li>Analyze HAL Overhead:
    <ul>
      <li>Compare the toggle frequency between HAL and LL implementations</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="walkthrough">Walkthrough</h2>
<h3 id="step-1-cubemx-configuration">Step 1: CubeMX Configuration</h3>
<ol>
  <li>Open CubeMX and create a new project for your STM32F4 board</li>
  <li>Navigate to System Core &gt; GPIO
    <ul>
      <li>Set PA5 as <code class="language-text highlighter-rouge">LL_GPIO Output</code></li>
      <li>Set PA0 as <code class="language-text highlighter-rouge">LL_EXTI_GPIO</code></li>
    </ul>
  </li>
  <li>In <code class="language-text highlighter-rouge">NVIC Settings</code>, enable <code class="language-text highlighter-rouge">EXTI0 interrupt</code></li>
</ol>

<h3 id="step-2-code">Step 2: Code</h3>
<ol>
  <li>In <code class="language-text highlighter-rouge">main.c</code>, replace HAL delays with LL:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Replace HAL_Delay with LL_mDelay</span>
<span class="n">LL_mDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>Implement the button interrupt handler in <code class="language-text highlighter-rouge">stm32f4xx_it.c</code>:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">EXTI0_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">LL_EXTI_IsActiveFlag_0_31</span><span class="p">(</span><span class="n">LL_EXTI_LINE_0</span><span class="p">))</span> <span class="p">{</span>
 <span class="n">LL_EXTI_ClearFlag_0_31</span><span class="p">(</span><span class="n">LL_EXTI_LINE_0</span><span class="p">);</span>
 <span class="n">LL_GPIO_TogglePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">LL_GPIO_PIN_5</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="step-3-measuring-performance">Step 3: Measuring Performance</h3>
<ol>
  <li>Add a debug pin (e.g., PA6) and toggle it in a loop:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">LL_GPIO_TogglePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">LL_GPIO_PIN_6</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Connect STM32CubeMonitor to PA6 and measure the toggle frequency</li>
</ol>

<hr />

<h2 id="debugging">Debugging</h2>

<p><strong>LED Not Blinking</strong></p>
<ul>
  <li>Check if LL drivers are included in the project (Project &gt; Properties &gt; C/C++ Build &gt; Settings &gt; MCU GCC Compiler &gt; Include Paths)</li>
</ul>

<p><strong>Button Interrupt Not Triggering</strong></p>
<ul>
  <li>Verify <code class="language-text highlighter-rouge">LL_EXTI_Init()</code> configuration and NVIC enabling</li>
</ul>

<p><strong>STM32CubeMonitor Not Capturing Data</strong></p>
<ul>
  <li>Ensure the debug probe is connected and the correct pin is monitored</li>
</ul>

<p><strong>High HAL Overhead</strong></p>
<ul>
  <li>Use LL for time-critical sections and HAL for non-critical tasks</li>
</ul>

<h2 id="dictionary">Dictionary</h2>

<ul>
  <li><strong>HAL</strong>: Hardware Abstraction Layer (STM32â€™s high-level API)</li>
  <li><strong>LL</strong>: Low-Layer library (STM32â€™s register-level API)</li>
  <li><strong>EXTI</strong>: External Interrupt/Event Controller</li>
  <li><strong>NVIC</strong>: Nested Vectored Interrupt Controller</li>
  <li><strong>CMSIS</strong>: Cortex Microcontroller Software Interface Standard</li>
</ul>

<h2 id="resources">Resources</h2>

<ol>
  <li><a href="https://www.st.com/resource/en/user_manual/dm00105879.pdf">STM32F4 LL Driver Documentation</a> <a href="https://www.st.com/content/ccc/resource/technical/document/user_manual/2f/77/25/0f/5c/38/48/80/DM00122015.pdf/files/DM00122015.pdf/jcr:content/translations/en.DM00122015.pdf">(STM32F0)</a></li>
  <li><a href="https://community.st.com/t5/stm32-mcus-products/hal-vs-ll/td-p/432434">HAL vs LL</a></li>
  <li><a href="https://stackoverflow.com/questions/49596398/about-stm32-hal-quality-and-performance">About HAL performance</a></li>
  <li><a href="https://www.reddit.com/r/embedded/comments/sg7vey/to_hal_or_not_to_hal_the_definitive_answer/">To HAL or not to HAL</a></li>
</ol>

<h2 id="answers-to-questions">Answers to Questions</h2>

<ol>
  <li>LL uses direct register access without state checks</li>
  <li>Configure <code class="language-text highlighter-rouge">LL_EXTI_Init()</code> and enable the NVIC IRQ</li>
  <li><code class="language-text highlighter-rouge">HAL_GPIO_WritePin()</code></li>
  <li>Compare GPIO toggle cycles between HAL and LL implementations</li>
</ol>

<hr />

<h2 id="credits">Credits</h2>

<!--Written by Jorge Porras (2025)-->
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1">
      <p>Deepseek.Â <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

</div>
</article>
  </main>

  <!-- _includes/footer.html -->
<footer class="site-footer">
  <div class="footer-content">
    <div class="social-links">
      <a href="https://github.com/yoon-zh" class="hover-glow" aria-label="GitHub">
        <i class="fab fa-github"></i>
      </a>
      <a href="mailto:yoon_zh@outlook.com" class="hover-glow" aria-label="Email">
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://www.linkedin.com/in/jorge-porras-1a7393282/" class="hover-glow" aria-label="LinkedIn">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://t.me/yo_o_n" class="hover-glow" aria-label="Telegram">
        <i class="fab fa-telegram-plane"></i>
      </a>
    </div>
    <div class="footer-bottom">
      <p>Â© 2025 ìœ¤å¿—</p>
    </div>
  </div>
</footer>
<script src="/scripts/main.js"></script>
<script src="/scripts/codeblocks.js"></script>
<script src="/scripts/axeptio.js"></script>
</body>
</html>